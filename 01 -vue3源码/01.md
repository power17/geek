# Vue3 源码分析
## 1.我们为什么学源码
- 装13
- 内卷应付面试
- 加深理解
- 增强解决问题能力
- 掌握真正傍身技能
## 2.源码学习方法分享
- 找到一条主线
- 画一张思维导图
- 提出一个问题，去源码中找答案
- 造一个轮子
- 费曼学习法
## 3.搭建源码学习环境
```shell
 git clone git@github.com:vuejs/core.git 
pnpm install
# 在 package.json 上加 --sourcemap
pnpm  dev
# server
pnpm serve
```
#### 打开/packages/vue/examples/composition/todomvc 
- 打开开发者工具source
- cmd+P  打断点 createApp
- 找源文件 右键 reveal in sidebar
## 4、项目结构
- rollup 进行打包  jest进行单元测试 eslint进行代码质量管控  Ts进行编写  pretty进行代码格式化

```mermaid
stateDiagram-v2
vue --> compilerDom
vue --> reactvity
vue --> runtimeDom
compilerDom --> compilerDomCore
runtimeDom --> runtimeDomCore
```

 ## 5、vue初始化(学习方法：1、调试法 2、查看调用栈)
 
 -  new Vue().createApp.mount()
 ![Vue源码分析.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e2d5243498e4d7f897f3c136dad3332~tplv-k3u1fbpfcp-watermark.image?)
 - mount函数： 创建vNode，patch函数转化成真实dom挂载到根Dom节点上（#app）
 - patch函数： setupComponent挂载render函数， 递归生成真实dom树
 ![截屏2023-04-08 14.46.45.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34ce4ab008bf4517867d8797cd6e3291~tplv-k3u1fbpfcp-watermark.image?)
 - 挂载流程图
 
 ![未命名文件.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fbff7018449642f4b93ef2ad5332914d~tplv-k3u1fbpfcp-watermark.image?)
## 总结： vue3变化情况
- 函数式创建实例： 1、Ts强类型的支持 2、避免构造函数污染 3、api的简化，一致性增强 4、有利于treeshaking

## 6、更新流程分析
- setupRenderEffect建立更新机制
- 组件数据发生变化执行更新机制
- 内部调用dipatch
![截屏2023-04-08 16.21.46.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dee287f6d65f4fd1a0cbd0a095e06094~tplv-k3u1fbpfcp-watermark.image?)
 ### 代码分析
 - setupRenderEffect()
 - queueJob()
 - queueFlush()
 -  -----以下为async代码--- 
 -  flushJob()
 -  run()
 -  componentUpdatefn
 -  patch
![未命名文件.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81cbbc7a51164868a27279a13b2dc2aa~tplv-k3u1fbpfcp-watermark.image?)